# Mobazha RWA Marketplace 平台级分销合约设计文档

## 1. 业务场景
- 支持Mobazha平台多个卖家各自上架并销售自己的RWA Token（如房地产、债券等资产通证）。
- 买家可用稳定币（如USDT、USDC）或其他加密货币购买任意卖家的RWA Token。
- 卖家可随时充值/撤回未售RWA Token和提现收到的支付币。
- 交易全自动，无需仲裁机制。
- RWA Token的出售价格由预言机动态决定，确保价格实时公允。
- 平台管理建议采用多签钱包（如Gnosis Safe），所有管理操作需多签共同签名，提升安全性和合规性。
- KYC校验可动态开关，平台方可根据合规需求决定是否强制校验KYC。

## 2. 合约核心功能
- **多卖家多Token支持**：每个卖家可上架多个RWA Token，每个Token独立管理。
- **充值/撤回RWA Token**：卖家可充值和撤回未售出Token。
- **动态定价**：买家购买时，合约通过预言机获取RWA Token的实时价格，按当前价格成交。
- **多币种支付**：支持多种支付币种，合约可扩展币种白名单。
- **卖家提现**：卖家可随时提现收到的支付币。
- **平台手续费**：每笔交易收取一定比例手续费，归平台方所有。
- **白名单管理**：平台方可对卖家、RWA Token、支付币种进行白名单管理。
- **KYC/认证扩展**：KYC校验可动态开关，平台方可根据合规需求决定是否强制校验KYC。
- **预言机可升级**：平台方可更换预言机合约地址，便于适配不同预言机服务或升级。
- **合约暂停/恢复**：平台方可暂停/恢复合约，紧急情况下保障资金安全。
- **安全与权限**：卖家只能操作自己上架的Token和提现，买家可自由购买。

## 3. 典型流程
1. 卖家上架RWA Token，设置支持的支付币种。
2. 卖家充值RWA Token到合约。
3. 买家选择卖家、RWA Token、支付币种和购买数量，合约通过预言机获取价格，完成兑换。
4. 卖家随时提现支付币或撤回未售RWA Token。
5. 平台方可收取手续费、管理白名单、升级预言机、暂停合约、动态开关KYC等。

## 4. 预言机集成
- 合约集成主流预言机（如Chainlink），实时获取RWA Token对各支付币种的价格。
- 支持多Token多币种价格查询。
- 价格获取接口可升级，支持后续扩展。

## 5. 平台手续费
- 每笔交易收取一定比例手续费（如0.3%），自动归集到平台方地址。
- 平台方可调整手续费比例和平台地址。

## 6. 白名单与KYC
- 卖家、RWA Token、支付币种均可设置白名单。
- KYC校验可动态开关，平台方可根据合规需求决定是否强制校验KYC。
- 平台方通过链下认证后调用合约接口将用户KYC状态同步到链上。

## 7. 合约升级与管理
- 合约通过 registry/ContractManager 进行版本管理和寻址，便于后续升级和集成。
- 新合约部署后，需在 ContractManager 注册其地址，供前端和其他合约统一查询。
- 平台方可暂停/恢复合约，紧急情况下保障资金安全。

## 8. 事件系统
- 对所有关键操作（上架、充值、购买、提现、白名单变更、手续费变更、暂停、KYC开关等）都增加事件，便于前端和链上分析工具追踪。

---

> 本合约为平台级多卖家多Token分销场景设计，单一卖家分销合约（RwaDistributor）及其文档已废弃，建议仅使用本Marketplace方案。 